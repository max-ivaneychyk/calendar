function getTransitionEventName(){var t={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd otransitionend"},e=!1;for(var a in t)if(void 0!==document.body.style[a])return e=t[a];return e}function onceEvent(t,e,a){t.addEventListener(e,function n(s){a&&a.call&&a(s),t.removeEventListener(e,n)})}function Calendar(){this.monthName=["January","February","March","April","May","June","July","August","September","October","November","December"],this.templates={day:['<div class="{$data.dayClass}" data-time="{$data.time}">',"{$data.dayNum}","</div>"].join(""),headerCalendar:['<div class="cal-nav-month">',"<h2>{$data.month} {$data.year}</h2>","</div>"].join(""),footerCalendar:['<div class="cal-list-days">',"<div>MONDAY</div>","<div>WEDNESDAY</div>","<div>TUESDAY</div>","<div>THURSDAY</div>","<div>FRIDAY</div>","<div>SATURDAY</div>","<div>SUNDAY</div>","</div>",'<div class="cal-days">',"{$data.days}","</div>"].join("")},this.transitionend=getTransitionEventName(),this.day=(new Date).getDate(),this.month=parseInt((new Date).getMonth()),this.year=(new Date).getFullYear(),this.wrap=document.getElementById("cal-wrap"),this.btnPrev=document.getElementById("cal-nav-prev"),this.btnNext=document.getElementById("cal-nav-next");var t=this;this.headers=[],this.footers=[],this.btnPrev.addEventListener("mousedown",function(){var e=t.month>0?--t.month:t.month=11,a=t.month>0?t.year:--t.year;t.etatDown(e,a),t.unlock(!0)}),this.btnNext.addEventListener("mousedown",function(){var e=t.month<11?++t.month:t.month=0,a=t.month<11?t.year:++t.year;t.etatUp(e,a),t.unlock(!0)}),t.render(this.month,this.year,function(t){t.headers[0].addClass("rotate-normal"),t.footers[0].addClass("rotate-normal"),t.wrap.appendChild(t.headers[0]),t.wrap.appendChild(t.footers[0])})}Node.prototype.addClass=function(t){return this.classList.add(t),this},Node.prototype.removeClass=function(t){return this.classList.remove(t),this},Calendar.prototype={constructor:Calendar,unlock:function(t){t&&this.btnPrev.addClass("invisible")||this.btnPrev.removeClass("invisible"),t&&this.btnNext.addClass("invisible")||this.btnNext.removeClass("invisible")},parser:function(t,e){var a=this;a.$data=e||{};var n=t.replace(/\{[\w\d\$\.]*\}/gi,function(t){var e=t.slice(1,t.length-1).split(".");return a._searchLatest(a,e)});return n},_searchLatest:function t(e,a){return e=e[a.shift()],a.length&&e?t(e,a):e},getListDays:function(t,e){var a=32-new Date(e,t,32).getDate(),n=new Date(e,t,1).getDay();--n<0&&(n=6);var s=new Date(e,t,a).getDay();return s=s?7-s:0,s+=s+n+a==35?7:0,{firstEmpty:n,fillOut:a,lastEmpty:s}},createHeader:function(t,e){var a=this.templates.headerCalendar,n=this.monthName[t],s=document.createElement("div").addClass("cal-header");return s.setAttribute("data-month",n),s.innerHTML=this.parser(a,{month:n,year:e}),this.headers.push(s),s},createFooter:function(t,e){for(var a=this.getListDays(t,e),n="",s=32-new Date(e,t-1,32).getDate();a.firstEmpty--;){var i=this.parser(this.templates.day,{dayClass:"cal-day no-active",dayNum:s--,time:""});n=i.concat(n)}for(var r=1;r<=a.fillOut;r++)n+=this.parser(this.templates.day,{dayClass:"cal-day active",dayNum:r,time:e+"-"+t+"-"+r});for(var r=1;r<=a.lastEmpty;r++)n+=this.parser(this.templates.day,{dayClass:"cal-day no-active",dayNum:r,time:""});var o=document.createElement("div").addClass("cal-content");return o.innerHTML=this.parser(this.templates.footerCalendar,{days:n}),this.footers.push(o),o},render:function(t,e,a){this.createHeader(t,e),this.createFooter(t,e),a&&a.call&&a(this)},etatDown:function(t,e){this.render(t,e,function(t){t.headers[0].addClass("animation-down"),t.headers[1].addClass("rotate-normal"),t.footers[1].addClass("rotate-down").addClass("invisible"),setTimeout(function(){t.footers[1].addClass("animation-up").removeClass("invisible")},0),onceEvent(t.headers[0],t.transitionend,function(){t.clear(t)}),t.wrap.insertBefore(t.headers[1],t.wrap.firstChild),t.wrap.appendChild(t.footers[1])})},etatUp:function(t,e){this.render(t,e,function(t){t.footers[0].addClass("animation-up"),t.footers[1].addClass("rotate-normal"),t.headers[1].addClass("rotate-down").addClass("invisible"),setTimeout(function(){t.headers[1].addClass("animation-up").removeClass("invisible")},0),onceEvent(t.footers[0],t.transitionend,function(){t.clear(t)}),t.wrap.appendChild(t.headers[1]),t.wrap.insertBefore(t.footers[1],t.wrap.firstChild)})},clear:function(t){t.headers.shift().remove(),t.footers.shift().remove(),t.unlock(!1)}};var cal=new Calendar;